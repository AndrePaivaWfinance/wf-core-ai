# ================================================
# REDIS CONFIGURATION - MESH PLATFORM
# ================================================
# Otimizado para cache de conversas e memória do bot
# Versão: 2.1.0

# ================================================
# CONFIGURAÇÕES BÁSICAS
# ================================================
port 6379
bind 0.0.0.0
protected-mode yes
tcp-backlog 511
timeout 300
tcp-keepalive 300

# ================================================
# MEMÓRIA E PERSISTÊNCIA
# ================================================
# Máximo de memória (adequado para container)
maxmemory 256mb
maxmemory-policy allkeys-lru

# Persistência otimizada para cache
save 900 1      # Salvar se pelo menos 1 chave mudou em 900 segundos
save 300 10     # Salvar se pelo menos 10 chaves mudaram em 300 segundos
save 60 10000   # Salvar se pelo menos 10000 chaves mudaram em 60 segundos

stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# ================================================
# LOGGING
# ================================================
loglevel notice
logfile /data/redis.log
syslog-enabled no

# ================================================
# CONFIGURAÇÕES DE CLIENTE
# ================================================
databases 16
maxclients 100

# ================================================
# CONFIGURAÇÕES ESPECÍFICAS MESH
# ================================================
# Timeouts otimizados para bot conversations
hz 10

# Configurações para pub/sub (futuros recursos)
notify-keyspace-events ""

# ================================================
# SEGURANÇA
# ================================================
# Senha será definida via variável de ambiente
# requirepass definido no docker-compose

# Renomear comandos perigosos
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG "CONFIG_b835729c9f"

# ================================================
# OTIMIZAÇÕES DE PERFORMANCE
# ================================================
# Configurações para baixa latência
tcp-nodelay yes
latency-monitor-threshold 100

# Hash otimizações
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# List otimizações
list-max-ziplist-size -2
list-compress-depth 0

# Set otimizações
set-max-intset-entries 512

# ZSet otimizações
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# ================================================
# CONFIGURAÇÕES ESPECÍFICAS PARA CACHE
# ================================================
# Expirações automáticas para cleanup
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# ================================================
# MONITORAMENTO
# ================================================
# Habilitar estatísticas
latency-monitor-threshold 100

# Slow log para debug
slowlog-log-slower-than 10000
slowlog-max-len 128